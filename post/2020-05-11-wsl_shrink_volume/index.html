<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Shrinking WSL2 volume</title>
		<meta name="viewport" content="width=device-width">
		
		<link rel="stylesheet" href="http://anydot.in/css/hybrid.css">
		<link rel="stylesheet" href="http://anydot.in/css/style.css">
		<link rel="stylesheet" href="http://anydot.in/css/colors-dark.css">

		
	</head>
	<body>
		<header id="header">
			<h1><a href="http://anydot.in/">Anydot&#39;s blog</a></h1>
			<p></p>
		</header>

		<div id="page">
			<div id="sidebar">
				<nav>
	
		<ul class="nav">
			
				<li><a href="https://www.linkedin.com/in/p%C5%99emysl-hrub%C3%BD-aa340539/"><span>LinkedIn</span></a></li>
			
				<li><a href="/index.xml"><span>RSS Feed</span></a></li>
			
				<li><a href="https://twitter.com/anydot"><span>Twitter</span></a></li>
			
		</ul>
	
</nav>

			</div>

			<div id="content">
				
	<article class="post">
		<h1><a href="http://anydot.in/post/2020-05-11-wsl_shrink_volume/">Shrinking WSL2 volume</a> </h1>

		<div class="post-content"><p>As WSL2 uses EXT4 in VHD volume, the VHDs size can grow in time as one uses the WSL. Deleting files isn&rsquo;t enough and one has to zero-out the free blocks and run the VHD compaction.</p>
<p>From WSL2 console:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mount /dev/sdb -o remount,ro
zerofree -v /dev/sdb
</code></pre></div><p>From the Windows host&rsquo;s Admin powershell:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-posh" data-lang="posh"><span style="color:#75715e"># Install the HyperV management and powershell optional features</span>
wsl --shutdown
Import-Module -Name Hyper-v
Optimize-VHD -Mode Full -Verbose $env:LOCALAPPDATA\Packages\$((Get-AppxPackage *Ubuntu*).PackageFamilyName)\LocalState\ext4.vhdx
</code></pre></div></div>

		<p class="meta">Posted on <span class="postdate">06. May 2020</span></p>
	</article>

			</div>

			<footer id="footer">
				<p class="copyright">Powered by
					<a href="https://gohugo.io/">Hugo</a> and the
					<a href="https://github.com/bake/solar-theme-hugo">Solar</a>-theme.</p>
			</footer>
		</div>

		
	</body>
</html>
